/* esm.sh - esbuild bundle(@radix-ui/react-dismissable-layer@1.0.5) denonext production */
import k from"../../../../../../esm.sh/@babel/runtime@7.23.1/helpers/esm/extends.js";
import{createContext as K,forwardRef as T,useContext as H,useState as C,useEffect as b,createElement as R,useRef as p}from"../../../../../../esm.sh/preact@10.19.6/compat.js";
import{composeEventHandlers as m}from"../../../../../../esm.sh/_@radix-ui/primitive@1.0.1.js";
import{Primitive as x,dispatchDiscreteCustomEvent as M}from"../../../../../../esm.sh/v132/_@radix-ui/react-primitive@1.0.3.js";
import{useComposedRefs as q}from"../../../../../../esm.sh/v132/_@radix-ui/react-compose-refs@1.0.1.js";
import{useCallbackRef as B}from"../../../../../../esm.sh/v132/_@radix-ui/react-use-callback-ref@1.0.1.js";
import{useEscapeKeydown as j}from"../../../../../../esm.sh/v132/_@radix-ui/react-use-escape-keydown@1.0.3.js";
var h="dismissableLayer.update",X="dismissableLayer.pointerDownOutside",Y="dismissableLayer.focusOutside",g,F=K({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),G=T((n,e)=>{var o;let{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:t,onPointerDownOutside:r,onFocusOutside:f,onInteractOutside:d,onDismiss:l,...v}=n,a=H(F),[c,S]=C(null),u=(o=c?.ownerDocument)!==null&&o!==void 0?o:globalThis?.document,[,W]=C({}),A=q(e,s=>S(s)),y=Array.from(a.layers),[N]=[...a.layersWithOutsidePointerEventsDisabled].slice(-1),_=y.indexOf(N),D=c?y.indexOf(c):-1,U=a.layersWithOutsidePointerEventsDisabled.size>0,w=D>=_,z=Q(s=>{let $=s.target,P=[...a.branches].some(E=>E.contains($));!w||P||(r?.(s),d?.(s),s.defaultPrevented||l?.())},u),O=V(s=>{let $=s.target;[...a.branches].some(E=>E.contains($))||(f?.(s),d?.(s),s.defaultPrevented||l?.())},u);return j(s=>{D===a.layers.size-1&&(t?.(s),!s.defaultPrevented&&l&&(s.preventDefault(),l()))},u),b(()=>{if(c)return i&&(a.layersWithOutsidePointerEventsDisabled.size===0&&(g=u.body.style.pointerEvents,u.body.style.pointerEvents="none"),a.layersWithOutsidePointerEventsDisabled.add(c)),a.layers.add(c),L(),()=>{i&&a.layersWithOutsidePointerEventsDisabled.size===1&&(u.body.style.pointerEvents=g)}},[c,u,i,a]),b(()=>()=>{c&&(a.layers.delete(c),a.layersWithOutsidePointerEventsDisabled.delete(c),L())},[c,a]),b(()=>{let s=()=>W({});return document.addEventListener(h,s),()=>document.removeEventListener(h,s)},[]),R(x.div,k({},v,{ref:A,style:{pointerEvents:U?w?"auto":"none":void 0,...n.style},onFocusCapture:m(n.onFocusCapture,O.onFocusCapture),onBlurCapture:m(n.onBlurCapture,O.onBlurCapture),onPointerDownCapture:m(n.onPointerDownCapture,z.onPointerDownCapture)}))});var J=T((n,e)=>{let o=H(F),i=p(null),t=q(e,i);return b(()=>{let r=i.current;if(r)return o.branches.add(r),()=>{o.branches.delete(r)}},[o.branches]),R(x.div,k({},n,{ref:t}))});function Q(n,e=globalThis?.document){let o=B(n),i=p(!1),t=p(()=>{});return b(()=>{let r=d=>{if(d.target&&!i.current){let v=function(){I(X,o,l,{discrete:!0})},l={originalEvent:d};d.pointerType==="touch"?(e.removeEventListener("click",t.current),t.current=v,e.addEventListener("click",t.current,{once:!0})):v()}else e.removeEventListener("click",t.current);i.current=!1},f=window.setTimeout(()=>{e.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(f),e.removeEventListener("pointerdown",r),e.removeEventListener("click",t.current)}},[e,o]),{onPointerDownCapture:()=>i.current=!0}}function V(n,e=globalThis?.document){let o=B(n),i=p(!1);return b(()=>{let t=r=>{r.target&&!i.current&&I(Y,o,{originalEvent:r},{discrete:!1})};return e.addEventListener("focusin",t),()=>e.removeEventListener("focusin",t)},[e,o]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function L(){let n=new CustomEvent(h);document.dispatchEvent(n)}function I(n,e,o,{discrete:i}){let t=o.originalEvent.target,r=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:o});e&&t.addEventListener(n,e,{once:!0}),i?M(t,r):t.dispatchEvent(r)}var re=G,ae=J;export{ae as Branch,G as DismissableLayer,J as DismissableLayerBranch,re as Root};
//# sourceMappingURL=react-dismissable-layer.mjs.map