/* esm.sh - esbuild bundle(@radix-ui/react-focus-scope@1.0.4) denonext production */
import U from"../../../../../../esm.sh/@babel/runtime@7.23.1/helpers/esm/extends.js";
import{forwardRef as k,useState as A,useRef as T,useEffect as h,useCallback as _,createElement as M}from"../../../../../../esm.sh/preact@10.19.6/compat.js";
import{useComposedRefs as w}from"../../../../../../esm.sh/v132/_@radix-ui/react-compose-refs@1.0.1.js";
import{Primitive as K}from"../../../../../../esm.sh/v132/_@radix-ui/react-primitive@1.0.3.js";
import{useCallbackRef as y}from"../../../../../../esm.sh/v132/_@radix-ui/react-use-callback-ref@1.0.1.js";
var E="focusScope.autoFocusOnMount",b="focusScope.autoFocusOnUnmount",S={bubbles:!1,cancelable:!0};var Q=k((e,n)=>{let{loop:t=!1,trapped:a=!1,onMountAutoFocus:m,onUnmountAutoFocus:L,...R}=e,[o,g]=A(null),$=y(m),v=y(L),p=T(null),H=w(n,s=>g(s)),i=T({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;h(()=>{if(a){let s=function(u){if(i.paused||!o)return;let r=u.target;o.contains(r)?p.current=r:d(p.current,{select:!0})},f=function(u){if(i.paused||!o)return;let r=u.relatedTarget;r!==null&&(o.contains(r)||d(p.current,{select:!0}))},c=function(u){if(document.activeElement===document.body)for(let F of u)F.removedNodes.length>0&&d(o)};document.addEventListener("focusin",s),document.addEventListener("focusout",f);let l=new MutationObserver(c);return o&&l.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",s),document.removeEventListener("focusout",f),l.disconnect()}}},[a,o,i.paused]),h(()=>{if(o){C.add(i);let s=document.activeElement;if(!o.contains(s)){let c=new CustomEvent(E,S);o.addEventListener(E,$),o.dispatchEvent(c),c.defaultPrevented||(x(q(I(o)),{select:!0}),document.activeElement===s&&d(o))}return()=>{o.removeEventListener(E,$),setTimeout(()=>{let c=new CustomEvent(b,S);o.addEventListener(b,v),o.dispatchEvent(c),c.defaultPrevented||d(s??document.body,{select:!0}),o.removeEventListener(b,v),C.remove(i)},0)}}},[o,$,v,i]);let P=_(s=>{if(!t&&!a||i.paused)return;let f=s.key==="Tab"&&!s.altKey&&!s.ctrlKey&&!s.metaKey,c=document.activeElement;if(f&&c){let l=s.currentTarget,[u,r]=D(l);u&&r?!s.shiftKey&&c===r?(s.preventDefault(),t&&d(u,{select:!0})):s.shiftKey&&c===u&&(s.preventDefault(),t&&d(r,{select:!0})):c===l&&s.preventDefault()}},[t,a,i.paused]);return M(K.div,U({tabIndex:-1},R,{ref:H,onKeyDown:P}))});function x(e,{select:n=!1}={}){let t=document.activeElement;for(let a of e)if(d(a,{select:n}),document.activeElement!==t)return}function D(e){let n=I(e),t=N(n,e),a=N(n.reverse(),e);return[t,a]}function I(e){let n=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{let m=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||m?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)n.push(t.currentNode);return n}function N(e,n){for(let t of e)if(!V(t,{upTo:n}))return t}function V(e,{upTo:n}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n!==void 0&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function W(e){return e instanceof HTMLInputElement&&"select"in e}function d(e,{select:n=!1}={}){if(e&&e.focus){let t=document.activeElement;e.focus({preventScroll:!0}),e!==t&&W(e)&&n&&e.select()}}var C=j();function j(){let e=[];return{add(n){let t=e[0];n!==t&&t?.pause(),e=O(e,n),e.unshift(n)},remove(n){var t;e=O(e,n),(t=e[0])===null||t===void 0||t.resume()}}}function O(e,n){let t=[...e],a=t.indexOf(n);return a!==-1&&t.splice(a,1),t}function q(e){return e.filter(n=>n.tagName!=="A")}var Y=Q;export{Q as FocusScope,Y as Root};
//# sourceMappingURL=react-focus-scope.mjs.map